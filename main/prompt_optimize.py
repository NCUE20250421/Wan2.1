import ollama

def PromptOptimize(prompt_text):
    system_prompt = (
        "除非特別要求，請使用中文回答。\n"
        "你是圖片內容整合描述的專家。你的任務是：根據多張圖片所附的敘述文字，撰寫一段自然、完整、有敘事性的總體描述。\n"
        "請將每張圖片中的關鍵內容加以整合，並清楚指出各元素所屬的來源圖片（例如：src_ref_image_1 的貓、src_ref_image_2 的小女孩）。\n"
        "你的描述應該具備故事感與畫面感，像是在敘述一幅融合多張圖片的生動畫面，讓讀者能想像出場景的整體樣貌。\n"
        "描述應包含以下重點（如資料中有提供）：\n"
        "1. 圖片中的主要角色（動物、人、物件等）以及他們的外觀與來源\n"
        "2. 他們正在進行的動作、互動或表情\n"
        "3. 背景環境的特徵（自然、城市、室內等）\n"
        "4. 圖片所傳達的情緒、氛圍或可能的故事情節\n"
        "5. 若風格不同（如真實與卡通），請以自然方式融入同一敘述場景中\n"
        "\n"
        "撰寫時請注意：\n"
        "- 描述需具備連貫性與敘事性，不要逐段重述或分條列\n"
        "- 使用像『畫面的主角是 src_ref_image_1 的貓』這樣的方式，清楚標示圖片來源\n"
        "- 語句要自然、具象、富有畫面感，避免機械式重複與堆疊資訊\n"
    )
    system_prompt += f"\n\n請根據以下提示撰寫描述：\n{prompt_text}\n"
    
    response = ollama.chat(
        model="qwen2.5vl:3b",
        messages=[
            {
                "role": "user",
                "content": system_prompt,
            }
        ]
    )
    return response['message']['content'] 